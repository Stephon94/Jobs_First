{% extends 'base.html' %}
{% load static %}
{% load tags %}
{% block title %}Jobs First | Home{% endblock %}
{% block content %}



<!-- <img src="/uploads/{{impact_block_image}}"> -->


<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
	<ol class="carousel-indicators">
		{% for banner in banners %}
			{% if forloop.counter == 1 %}
				<li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
			{% else %}
				<li data-target="#carouselExampleIndicators" data-slide-to="{{forloop.counter0}}"></li>
			{% endif %}
		{% endfor %}
			
	</ol>
	<div class="carousel-inner">
		{% for banner in banners %}
			{% if forloop.counter == 1 %}
				<div class="carousel-item active">
			{% else %}
				<div class="carousel-item">
			{% endif %}
					<div class="carousel-content bg-header" style="background:url({{MEDIA_URL}}{{banner.image}})no-repeat center center;background-size: cover;" alt="First slide">
						<h1 class="text-white text-center">{{banner.text}}</h1>
					</div>
				</div>
		{% endfor %}
	</div>
	<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
		<span class="carousel-control-prev-icon" aria-hidden="true"></span>
		<span class="sr-only">Previous</span>
	</a>
	<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
		<span class="carousel-control-next-icon" aria-hidden="true"></span>
		<span class="sr-only">Next</span>
	</a>
</div>

<div class="container-fluid">
	<div class="row">
		<div class="col-md-7">
			<div class="text-center">
				<h1 class="title-1">{{problem_block_title}}</h1>
				<hr>
				<b >{{problem_block_text}}</b>
				<br>
				<br>
				<br>
				<br>
				<h1 class="title-1">{{solution_block_title}}</h1>
				<hr>
				<b>{{solution_block_text}}</b>
				<br>
				<br>
			</div>
			<div class="col-md-10 offset-md-1">
				<ul class="list-bullet">
					{% for solution in solutions %}
					<li><p><i class="fa fa-circle"></i>&nbsp;{{solution}}</p></li>
					{% endfor %}
				</ul>
			</div>
		</div>


		<div class="col-md-5">
			<div class="text-center">
				<h2 class="title-1">Featured</h2>
				<hr>
			</div>
			{% for feature in featured %}

			{% if feature.external_link %}
				{% if image %}
				<a href="{{feature.external_link}}">
					<div class="col-md-12">
						<div class="row ">
							<div class="col-md-4">
								<img src="/uploads/{{feature.image}}" class="img-thumbnail w-100">
							</div>
							<div class="col-md-8 px-3">
								<div class="card-block px-3">
									<h4 class="title-1">{{feature.publish_date}}</h4>
									<h5 class="card-text">{{feature.title}}</h5>
									<i>{{feature.author_first_name}} {{feature.author_last_name}}</i>
								</div>
							</div>
						</div>
					</div>
				</a>
					{% else %}
					<a href="{{feature.external_link}}">
					<div class="col-md-12">
						<div class="row ">
							<div class="col-md-4">
								<img src="http://via.placeholder.com/100" class="img-thumbnail w-100">
							</div>
							<div class="col-md-8 px-3">
								<div class="card-block px-3">
									<h4 class="title-1">{{feature.publish_date}}</h4>
									<h5 class="card-text">{{feature.title}}</h5>
									<i>{{feature.author_first_name}} {{feature.author_last_name}}</i>
								</div>
							</div>
						</div>
					</div>
					</a>
					{% endif %}
				{% endif %}
			{% endfor %}
		</div>
	</div>
</div>



<div class="container-fluid text-center" style="background:url({{impact_block_image|media_url}})no-repeat center center;background-size: cover;">
	<h1 class="title-2">{{impact_block_title}}</h1>
	<hr>
	<p class="text-white">{{impact_block_text}}</p>
	<br>
	<br>
	<div class="carousel slide" data-ride="carousel" id="gallery">
		<center>
			<div class="carousel-inner" style="width: 80%">
				<div class="carousel-item active">
					<div class="row">
						{% for affiliate in affiliates %}
						{% if affiliate.image %}
						<div class="col-md-2 mx-auto">
							<a href="/our-work?id=tab{{forloop.counter}}" class="text-white">
								<div style="background:url(/uploads/{{affiliate.image}}) no-repeat center center; min-height:85px;background-size: cover" class="vertical-text">
<!-- =======
							<a href="/our-work?id=tab1" class="text-white">
								<div style="background:url(/uploads/impact_banner/no-banner-img.jpg)no-repeat center center; min-height: 85px;" class="vertical-text">
									test
								</div>
							</a>
						</div>
						<div class="col">
							<a href="/our-work?id=tab2" class="text-white">
								<div style="background:url(/uploads/impact_banner/no-banner-img.jpg)no-repeat center center; min-height: 85px;" class="vertical-text">
									test
								</div>
							</a>
						</div>
						<div class="col">
							<a href="/our-work?id=tab3" class="text-white">
								<div style="background:url(/uploads/impact_banner/no-banner-img.jpg)no-repeat center center; min-height: 85px;" class="vertical-text">
									test
								</div>
							</a>
						</div>
						<div class="col">
							<a href="/our-work?id=tab4" class="text-white">
								<div style="background:url(/uploads/impact_banner/no-banner-img.jpg)no-repeat center center; min-height: 85px;" class="vertical-text">
									test
								</div>
							</a>
						</div>
						<div class="col">
							<a href="/our-work?id=tab5" class="text-white">
								<div style="background:url(/uploads/impact_banner/no-banner-img.jpg)no-repeat center center; min-height: 85px;" class="vertical-text">
>>>>>>> 29f9e0066878d99fcefc1b962f21e90265b009c8 -->
								{{affiliate.title}}
								</div>
							</a>
						</div>
						{% endif %}
						{% endfor %}
					</div>
				</div>
			</div>	
		</center>
	</div>
</div>
<!-- MAP GOES HERE ON THIS DIV vvvvvvv -->
<div class="vertical-center">

	<div class="vertical-center" id="map"></div>

	<script type="text/javascript">

			</script>


			<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAcW1PxLnVz7Jw884zdUA5JW-6LjTC6tr4&callback=initMap" async defer></script>
			<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-circle-progress/1.2.2/circle-progress.js"></script>
			<script type="text/javascript">
			var charts = document.getElementById("charts");
		
		var progress1 = new CircularProgress(charts, {fill: "#f0f0f0"});
		setInterval(function(){progress1.update([Math.floor(Math.random()*100) + 1])},1000);
				function initMap() {
					var styles = [
					{
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#f5f5f5"
						}
						]
					},
					{
						"elementType": "labels.icon",
						"stylers": [
						{
							"visibility": "off"
						}
						]
					},
					{
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#616161"
						}
						]
					},
					{
						"elementType": "labels.text.stroke",
						"stylers": [
						{
							"color": "#f5f5f5"
						}
						]
					},
					{
						"featureType": "administrative",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#4563ab"
						}
						]
					},
					{
						"featureType": "administrative.land_parcel",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#bdbdbd"
						}
						]
					},
					{
						"featureType": "poi",
						"stylers": [
						{
							"visibility": "off"
						}
						]
					},
					{
						"featureType": "poi",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#eeeeee"
						}
						]
					},
					{
						"featureType": "poi",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#757575"
						}
						]
					},
					{
						"featureType": "poi.park",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#e5e5e5"
						}
						]
					},
					{
						"featureType": "poi.park",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#9e9e9e"
						}
						]
					},
					{
						"featureType": "road",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#ffffff"
						}
						]
					},
					{
						"featureType": "road.arterial",
						"elementType": "geometry.fill",
						"stylers": [
						{
							"color": "#e6f1c9"
						}
						]
					},
					{
						"featureType": "road.arterial",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#757575"
						}
						]
					},
					{
						"featureType": "road.highway",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#dadada"
						}
						]
					},
					{
						"featureType": "road.highway",
						"elementType": "geometry.fill",
						"stylers": [
						{
							"color": "#b5d76a"
						}
						]
					},
					{
						"featureType": "road.highway",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#616161"
						}
						]
					},
					{
						"featureType": "road.local",
						"elementType": "geometry.fill",
						"stylers": [
						{
							"color": "#ebf3d6"
						}
						]
					},
					{
						"featureType": "road.local",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#9e9e9e"
						}
						]
					},
					{
						"featureType": "transit.line",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#e5e5e5"
						}
						]
					},
					{
						"featureType": "transit.station",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#eeeeee"
						}
						]
					},
					{
						"featureType": "water",
						"elementType": "geometry",
						"stylers": [
						{
							"color": "#c9c9c9"
						}
						]
					},
					{
						"featureType": "water",
						"elementType": "labels.text.fill",
						"stylers": [
						{
							"color": "#9e9e9e"
						}
						]
					}
					];
					var poly;

					$(".map-overlay").hide();
					var styledMap = new google.maps.StyledMapType(styles, {name: "Styled Map"});

					map = new google.maps.Map(document.getElementById("map"), {
						center: new google.maps.LatLng(
							{% if start_location %}
							{{start_location.0}},{{start_location.1}}
							{% else %}
							40.75738,-73.990107
							{% endif %}
							),
						zoom: 10,
						disableDefaultUI: true
					});

					map.mapTypes.set('map_style', styledMap);
					map.setMapTypeId('map_style');

					$.getJSON( "https://data.cityofnewyork.us/resource/ith2-q832.json", function( data ) {
						$.getJSON( "{% static 'js/mapData.json' %}", function( data1 ) {						
							var polygonArray = [];
							console.log(data1);
							var addListenersOnPolygon = function(polygon, id) {
								google.maps.event.addListener(polygon, 'click', function (event) {
									for (i in polygonArray) {
										polygonArray[i].setOptions({strokeWeight: 1.0, fillColor: '#b5d76a'});
									}
									polygon.setOptions({strokeWeight: 2.0, fillColor: 'green'});
									$( "#org-title" ).html(data1[id]["Neighborhood"]);
									$('#circle1').circleProgress({value: parseFloat(data1[id]["18-24 OSOW rate (2008-10)"])/100});
									$('#circle2').circleProgress({value: parseFloat(data1[id]["18-24 OSOW rate (2013-15)"])/100});
									$( "#circle1-alt" ).html(data1[id]["18-24 OSOW rate (2008-10)"]);
									$( "#circle2-alt" ).html(data1[id]["18-24 OSOW rate (2013-15)"]);
									$( "#circle1-num" ).html(data1[id]["Number of OSOW 18%u201324s (2008-10)"]);
									$( "#circle2-num" ).html(data1[id]["Number of OSOW 18%u201324s (2013-15)"]);						
									$(".map-overlay").show();
								});  
							}
							
							for(var q =0; q < data.length; q++){
								var paths = [];
								var district = 0;
								var coords = data[q]["the_geom"].coordinates; 
								for (var i = 0; i < coords.length; i++) { 
									for (var j = 0; j < coords[i].length; j++) { 
										var path = []; 
										for (var k = 0; k < coords[i][j].length; k++) { 
											var ll = new google.maps.LatLng(coords[i][j][k][1],coords[i][j][k][0]); 
											path.push(ll); 
										} 
										district = data[q]["puma"];
										paths.push(path);
									} 
								} 
								var polygon = new google.maps.Polygon({ 
									paths: paths, 
									strokeColor: "#4563ab", 
									strokeOpacity: 1, 
									strokeWeight: 1, 
									fillColor: "#b5d76a", 
									fillOpacity: 0.5 
								}); 
								polygonArray.push(polygon);
								polygon.setMap(map);
								for(var z = 0; z < data1.length; z++){
									if(data1[z]["code"] == district){
										addListenersOnPolygon(polygon, z);
									}
								}									
							}
						});
					});

					google.maps.event.addListenerOnce(map, 'tilesloaded', addMarkers);
					$(".map-overlay").appendTo("#map");
				}

				function addMarkers() {
				        {% for location in locations %}
				        {% for coordinates, info in location.items %}
				        var point = new google.maps.LatLng({{coordinates.0}},{{coordinates.1}});
				        var marker = new google.maps.Marker({
				        	position: point,
				        	map: map
				        });

								console.log({{coordinates.0}},{{coordinates.1}})
								console.log('{{info.0}}','{{info.1}}')

				        google.maps.event.addListener(marker, 'mouseover', function() {
				        	map.panTo({lat:{{coordinates.0}},lng:{{coordinates.1}}});
				        	$( "#org-title" ).html( "{{info.0}}" );
				        	$( "#org-des" ).html( "{{info.1}}" );
				        	$(".map-overlay").show();
				        });

				        google.maps.event.addListener(marker, 'mouseout', function() {
				        	$(".map-overlay").hide();
				        });
								{% endfor %}
								{% endfor %}
				      }
				      initMap();
				  </script>
	<br>
	<div class="col-md-4 offset-md-1 map-overlay">
		<h4 class="title-1 text-center" id=org-title></h4>
		<div class="row text-center">
			<div class="col-md-6">
				<div id="circle1">
					<strong id="circle1-alt" style="position: absolute;top: 30px;left: 0;width: 100%;text-align: center;line-height: 40px;font-size: 30px;">.75</strong>
				</div>
				<p>18-24 OSOW rate (2008-10)</p> 
				<p class="text-secondary" id="circle1-num">1000</p>
			</div>
			<div class="col-md-6">
				<div id="circle2">
					<strong id="circle2-alt" style="position: absolute;top: 30px;left: 0;width: 100%;text-align: center;line-height: 40px;font-size: 30px;">.75</strong>					
				</div>
				<p>18-24 OSOW rate (2013-15)</p>
				<p class="text-secondary" id="circle2-num">1000</p> 
			</div> 
			<div class="col-md-12">
				<button class="btn green-btn text-white" id="close" onclick='$(".map-overlay").hide();'>Close</button>
			</div>
		</div>
	</div>
</div>

{% endblock %}
